!function(a){var b=function(b){var c=this,d=a(b),e={};e.feed=d.find("#gf_ideal_feed"),e.gravityForm=d.find("#gf_ideal_gravity_form"),e.formId=d.find("#_pronamic_pay_gf_form_id"),e.configId=d.find("#gf_ideal_config_id"),e.delayPostCreationItem=d.find("#gf_ideal_delay_post_creation_item"),e.conditionEnabled=d.find("#gf_ideal_condition_enabled"),e.conditionConfig=d.find("#gf_ideal_condition_config"),e.conditionFieldId=d.find("#gf_ideal_condition_field_id"),e.conditionOperator=d.find("#gf_ideal_condition_operator"),e.conditionValue=d.find("#gf_ideal_condition_value"),e.userRoleFieldId=d.find("#gf_ideal_user_role_field_id"),e.delayNotifications=d.find("#gf_ideal_delay_notifications"),e.delayNotificationsHolder=d.find(".pronamic-pay-gf-notifications"),e.fieldSelectFields=d.find("select.field-select");var f=a.parseJSON(e.feed.val()),g=a.parseJSON(e.gravityForm.val());this.updateDelayPostCreationItem=function(){var a=!1;if(g){var b=c.getFieldsByType(["post_title","post_content","post_excerpt","post_category","post_custom_field","post_image","post_tag"]);b.length>0&&(a=!0)}e.delayPostCreationItem.toggle(a)},this.toggleConditionConfig=function(){e.conditionEnabled.prop("checked")?e.conditionConfig.fadeIn("fast"):e.conditionConfig.fadeOut("fast")},this.updateConditionFields=function(){e.conditionFieldId.empty(),a("<option>").appendTo(e.conditionFieldId),g&&(a.each(g.fields,function(b,c){var d=c.inputType?c.inputType:c.type,g=a.inArray(d,["checkbox","radio","select"]);if(g>=0){var h=c.adminLabel?c.adminLabel:c.label;a("<option>").attr("value",c.id).text(h).prop("selected",f.conditionFieldId==c.id).appendTo(e.conditionFieldId)}}),e.conditionOperator.val(f.conditionOperator))},this.updateConditionValues=function(){var b=e.conditionFieldId.val(),d=c.getFieldById(b);e.conditionValue.empty(),a("<option>").appendTo(e.conditionValue),d&&d.choices&&(a.each(d.choices,function(b,c){var d=c.value?c.value:c.text;a("<option>").attr("value",d).text(c.text).appendTo(e.conditionValue)}),e.conditionValue.val(f.conditionValue))},this.getFieldById=function(a){if(g)for(var b=0;b<g.fields.length;b++)if(g.fields[b].id==a)return g.fields[b];return null},this.getFieldsByType=function(b){var c=[];if(g)for(var d=0;d<g.fields.length;d++)a.inArray(g.fields[d].type,b)>=0&&c.push(g.fields[d]);return c},this.getInputs=function(){var b=[];return g&&a.each(g.fields,function(c,d){d.inputs?a.each(d.inputs,function(a,c){b.push(c)}):d.displayOnly||b.push(d)}),b},this.changeForm=function(){jQuery.get(ajaxurl,{action:"gf_get_form_data",formId:e.formId.val()},function(a){a.success&&(g=a.data,c.updateFields())})},this.updateUserRoleFields=function(){e.userRoleFieldId.empty(),a("<option>").appendTo(e.userRoleFieldId),g&&a.each(g.fields,function(b,c){var d=c.adminLabel?c.adminLabel:c.label;a("<option>").attr("value",c.id).text(d).prop("selected",f.userRoleFieldId==c.id).appendTo(e.userRoleFieldId)})},this.updateConfigFields=function(){var a=e.configId.find("option:selected").attr("data-ideal-method");d.find(".extra-settings").hide(),d.find(".method-"+a).show()},this.updateNotifications=function(){if(e.delayNotificationsHolder.empty(),g){var b=a("<ul>").appendTo(e.delayNotificationsHolder);a.each(g.notifications,function(c,d){var e=a("<li>").appendTo(b),g="pronamic-pay-gf-notification-"+d.id;a('<input type="checkbox" name="_pronamic_pay_gf_delay_notification_ids[]">').attr("id",g).val(d.id).prop("checked",a.inArray(d.id,f.delayNotificationIds)>=0).appendTo(e),e.append(" "),a("<label>").attr("for",g).text(d.name).appendTo(e)})}},this.updateSelectFields=function(){g&&(e.fieldSelectFields.empty(),e.fieldSelectFields.each(function(b,e){d=a(e);var g=d.data("gateway-field-name");a("<option>").appendTo(d),a.each(c.getInputs(),function(b,c){var e=c.adminLabel?c.adminLabel:c.label;a("<option>").attr("value",c.id).text(e).prop("selected",f.fields[g]==c.id).appendTo(d)})}))},this.updateFields=function(){c.updateConfigFields(),c.updateDelayPostCreationItem(),c.toggleConditionConfig(),c.updateConditionFields(),c.updateConditionValues(),c.updateUserRoleFields(),c.updateSelectFields(),c.updateNotifications()},c.updateFields(),e.formId.change(c.changeForm),e.configId.change(c.updateConfigFields),e.conditionEnabled.change(c.toggleConditionConfig),e.conditionFieldId.change(c.updateConditionValues),e.delayNotifications.change(function(){a("input",e.delayNotificationsHolder).prop("checked",a(this).prop("checked"))})};a.fn.gravityFormsIdealFeedEditor=function(){return this.each(function(){var c=a(this);if(!c.data("gf-ideal-feed-editor")){var d=new b(this);c.data("gf-ideal-feed-editor",d)}})};var c=function(b){var c=this,d=a(b),e={};e.variantId=d.find("#pronamic_gateway_id"),this.updateConfigFields=function(){var b=e.variantId.find("option:selected").data("pronamic-pay-settings");d.find(".extra-settings").hide(),a.isArray(b)&&a.each(b,function(a,b){d.find(".setting-"+b).show()})},this.updateFields=function(){c.updateConfigFields()},c.updateFields(),e.variantId.change(c.updateConfigFields)};a.fn.pronamicPayGatewayConfigEditor=function(){return this.each(function(){var b=a(this);if(!b.data("pronamic-pay-gateway-config-editor")){var d=new c(this);b.data("pronamic-pay-gateway-config-editor",d)}})};var d=function(b){var c=this,d=a(b),e={};e.amountMethod=d.find('select[name="_pronamic_payment_form_amount_method"]'),this.updateAmountsVisibility=function(){var a=e.amountMethod.val();"choices_only"===a||"choices_and_input"===a?d.find('input[name="_pronamic_payment_form_amount_choices[]"]').closest("div").show():d.find('input[name="_pronamic_payment_form_amount_choices[]"]').closest("div").hide()},this.maybeAddAmountChoice=function(){e.amountChoices=d.find('input[name="_pronamic_payment_form_amount_choices[]"]');var a=e.amountChoices.filter(function(){return""===this.value});if(0===a.length){var b=e.amountChoices.last().closest("div"),c=b.clone(),f="_pronamic_payment_form_amount_choice_"+e.amountChoices.length;c.find("input").attr("id",f).val(""),c.find("label").attr("for",f),b.after(c)}},c.updateAmountsVisibility(),e.amountMethod.change(c.updateAmountsVisibility),d.on("keyup",'input[name="_pronamic_payment_form_amount_choices[]"]',function(){c.maybeAddAmountChoice()})};a.fn.pronamicPayFormOptions=function(){return this.each(function(){var b=a(this);if(!b.data("pronamic-pay-forms-options")){var c=new d(this);b.data("pronamic-pay-form-options",c)}})},a(document).ready(function(){if("object"==typeof fieldSettings&&(fieldSettings.ideal_issuer_drop_down=".label_setting, .admin_label_setting, .size_setting, .description_setting, .css_class_setting, .error_message_setting, .rules_setting, .conditional_logic_field_setting",fieldSettings.pronamic_pay_payment_method_selector=".label_setting, .admin_label_setting, .size_setting, .description_setting, .css_class_setting, .error_message_setting, .rules_setting, .conditional_logic_field_setting"),a(".gforms_edit_form .ideal-edit-link").click(function(a){a.stopPropagation()}),a("#gf-ideal-feed-editor").gravityFormsIdealFeedEditor(),a("#pronamic-pay-gateway-config-editor").pronamicPayGatewayConfigEditor(),a("#pronamic_payment_form_options").pronamicPayFormOptions(),"undefined"!=typeof gform&&"undefined"!=typeof form){gform.addFilter("gform_is_conditional_logic_field",function(a,b){return"pronamic_pay_payment_method_selector"===b.type||a});var b=[];a.each(form.fields,function(c,d){"pronamic_pay_payment_method_selector"===d.type&&a.each(d.choices,function(a,c){c.pronamic_supported_pm&&b.push(c.pronamic_supported_pm)})}),gform.addAction("gform_load_field_choices",function(c){"pronamic_pay_payment_method_selector"===c[0].type&&(a("#field_choice_values_enabled").parent("div").hide(),a(".field-choice-input.field-choice-value").keyup(function(){-1<a.inArray(this.value,b)&&(this.value=this.value+"_2")}),a.each(b,function(b,c){var d=a('.field-choice-input.field-choice-value[value="'+c+'"]');d.attr("disabled","disabled"),d.parent("li").find(".gf_delete_field_choice").remove()}))})}})}(jQuery);