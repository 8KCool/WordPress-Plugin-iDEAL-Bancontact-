!function(t){t.fn.pronamicPayGatewayConfigEditor=function(){return this.each(function(){var i=t(this);if(!i.data("pronamic-pay-gateway-config-editor")){var e=new function(i){var e=this,a=t(i),n={};n.variantId=a.find("#pronamic_gateway_id"),n.extraSettings=a.find("div.extra-settings"),n.sectionHeaders=a.find(".gateway-config-section-header"),n.tabs=a.find(".pronamic-pay-tabs"),n.tabItems=a.find("ul.pronamic-pay-tabs-items"),n.pkCertFieldsToggle=t("#pk-cert-fields-toggle"),this.updateFields=function(){e.selectedVariant=n.variantId.find("option:selected"),e.settings=e.selectedVariant.data("pronamic-pay-settings"),a.find(".extra-settings").hide(),e.settingElements=[],t.isArray(e.settings)&&t.each(e.settings,function(t,i){a.find(".setting-"+i).show()}),a.find(".setting-"+e.selectedVariant.val()).show();var i=e.selectedVariant.text().split(" - ")[0].replace(/ \(.*\)/,"");n.tabItems.find(":visible").first().text(i).click(),t("#pronamic-pay-gateway-description").html(e.selectedVariant.attr("data-gateway-description")),n.pkCertFieldsToggle.length>0&&n.extraSettings.find("tr.pk-cert").hide()},this.updateRowBackgroundColor=function(){var t=n.extraSettings.find(".form-table tr");t.removeClass("even"),t.filter(":visible:even").addClass("even")},this.initTabs=function(){t.each(n.sectionHeaders,function(i,e){var a=t(e),s=a.find("h4").text(),o=a.parents("div")[0].className;n.tabItems.append(t("<li>"+s+"</li>").addClass(o).removeClass("pronamic-pay-tab"))}),n.tabItems.next().after(n.tabItems),n.tabItems.find("li").click(e.showTabSettings)},this.showTabSettings=function(){var i=t(this);n.extraSettings.hide().eq(i.index()).show()},this.togglePkCertFields=function(t){return t.preventDefault&&t.preventDefault(),n.pkCertFieldsToggle.hasClass("active")?(n.pkCertFieldsToggle.removeClass("active"),n.extraSettings.find("tr.pk-cert").hide()):(n.pkCertFieldsToggle.addClass("active"),n.extraSettings.find("tr.pk-cert").show()),e.updateRowBackgroundColor(),!1},e.initTabs(),e.updateFields(),n.variantId.change(e.updateFields),n.pkCertFieldsToggle.click(e.togglePkCertFields)}(this);i.data("pronamic-pay-gateway-config-editor",e)}})};t.fn.pronamicPayTabs=function(){return this.each(function(){var i=t(this);if(!i.data("pronamic-pay-tabs")){var e=new function(i){var e=this,a=t(i),n={};n.tabItems=a.find("ul.pronamic-pay-tabs-items"),n.tabs=a.find(".pronamic-pay-tab"),n.tabItems=a.find("ul.pronamic-pay-tabs-items"),this.updateRowBackgroundColor=function(){var t=n.tabs.find(".form-table tr");t.removeClass("even"),t.filter(":visible:even").addClass("even")},this.showTab=function(){var i=t(this);n.tabItems.find("li").removeClass("active"),i.addClass("active"),n.tabs.hide().eq(i.index()).show(),e.updateRowBackgroundColor(),e.visibleTabItems=n.tabItems.find("li:visible"),e.activeTabItem=i},this.responsiveTabs=function(){if(t(window).width()>960)n.tabs.hide(),e.activeTabItem?e.activeTabItem.click():n.tabItems.find("li:visible").first().click();else{if(!e.visibleTabItems)return;n.tabs.hide(),t.each(e.visibleTabItems,function(i,e){n.tabs.eq(t(e).index()).show()})}},n.tabItems.find("li").click(e.showTab),n.tabItems.find("li:visible").first().click(),t(window).resize(e.responsiveTabs)}(this);i.data("pronamic-pay-tabs",e)}})};t.fn.pronamicPayGatewayTest=function(){return this.each(function(){var i=t(this);if(!i.data("pronamic-pay-gateway-test")){var e=new function(i){var e=t(i),a={};a.paymentMethods=e.find('select[name="pronamic_pay_test_payment_method"]'),this.updateInputVisibility=function(){var i=a.paymentMethods.val();""!==i&&e.find(".pronamic-pay-test-payment-method").hide().filter("."+i).show(),1===a.paymentMethods.find("option:selected").data("is-recurring")?t("#pronamic-pay-test-subscription").parents("tr").show():(t("#pronamic-pay-test-subscription").parents("tr").hide(),t("#pronamic-pay-test-subscription").prop("checked",!1).trigger("change"))},this.updateInputVisibility(),a.paymentMethods.change(this.updateInputVisibility),e.on("keydown",'input[name="test_amount"]',function(t){13===t.keyCode&&e.find('input[name="test_pay_gateway"]').click()})}(this);i.data("pronamic-pay-gateway-test",e)}})};t.fn.pronamicPayFormOptions=function(){return this.each(function(){var i=t(this);if(!i.data("pronamic-pay-forms-options")){var e=new function(i){var e=this,a=t(i),n={};n.amountMethod=a.find('select[name="_pronamic_payment_form_amount_method"]'),this.updateAmountsVisibility=function(){var t=n.amountMethod.val();"choices_only"===t||"choices_and_input"===t?a.find('input[name="_pronamic_payment_form_amount_choices[]"]').closest("div").show():a.find('input[name="_pronamic_payment_form_amount_choices[]"]').closest("div").hide()},this.maybeAddAmountChoice=function(){if(n.amountChoices=a.find('input[name="_pronamic_payment_form_amount_choices[]"]'),0===n.amountChoices.filter(function(){return""===this.value}).length){var t=n.amountChoices.last().closest("div"),i=t.clone(),e="_pronamic_payment_form_amount_choice_"+n.amountChoices.length;i.find("input").attr("id",e).val(""),i.find("label").attr("for",e),t.after(i)}},e.updateAmountsVisibility(),n.amountMethod.change(e.updateAmountsVisibility),a.on("keyup",'input[name="_pronamic_payment_form_amount_choices[]"]',function(){e.maybeAddAmountChoice()})}(this);i.data("pronamic-pay-form-options",e)}})},t(document).ready(function(){t("#pronamic-pay-gateway-config-editor").pronamicPayGatewayConfigEditor(),t("#pronamic_payment_form_options").pronamicPayFormOptions(),t("#pronamic_gateway_test").pronamicPayGatewayTest(),t(".pronamic-pay-tabs").pronamicPayTabs(),tippy(".pronamic-pay-tip",{arrow:!0,theme:"pronamic-pay"})})}(jQuery);