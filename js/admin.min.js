!function(a){var b=function(b){var c=this,d=a(b),e={};e.variantId=d.find("#pronamic_gateway_id"),e.extraSettings=d.find("div.extra-settings"),e.sectionHeaders=d.find(".gateway-config-section-header"),e.tabs=d.find(".pronamic-pay-tabs"),e.tabItems=d.find("ul.pronamic-pay-tabs-items"),e.pkCertFieldsToggle=a("#pk-cert-fields-toggle"),this.updateFields=function(){c.selectedVariant&&(e.tabs.removeClass(c.selectedVariant.val()),e.extraSettings.find(".show-"+c.selectedVariant.val()).hide(),e.extraSettings.find(".hide-"+c.selectedVariant.val()).show()),c.selectedVariant=e.variantId.find("option:selected"),c.settings=c.selectedVariant.data("pronamic-pay-settings");var b=c.selectedVariant.text().split(" - ")[0].replace(/ \(.*\)/,"");if(d.find(".extra-settings").hide(),c.settingElements=[],a.isArray(c.settings)){var f;a.each(c.settings,function(a,b){f=d.find(".setting-"+b),f.show(),c.settingElements.push(f)})}e.extraSettings.find(".show-"+c.selectedVariant.val()).show(),e.extraSettings.find(".hide-"+c.selectedVariant.val()).hide(),e.tabItems.find(":visible").first().text(b).click(),c.initPkCertFields(),c.updateRowBackgroundColor(),a("#pronamic-pay-gateway-description").html(c.selectedVariant.attr("data-gateway-description"))},this.updateRowBackgroundColor=function(){var a=e.extraSettings.find(".form-table tr");a.removeClass("even"),a.filter(":visible:even").addClass("even")},this.initTabs=function(){a.each(e.sectionHeaders,function(b,c){var d=a(c),f=d.find("h4").text(),g=d.parents("div")[0].className;e.tabItems.append(a("<li>"+f+"</li>").addClass(g))}),e.tabItems.next().after(e.tabItems),e.tabItems.find("li").click(c.showTab)},this.showTab=function(){var b=a(this);e.tabItems.find("li").removeClass("active"),b.addClass("active"),e.extraSettings.hide().eq(b.index()).show()},this.initPkCertFields=function(){var b=a("#_pronamic_gateway_ideal_private_key"),c=a("#_pronamic_gateway_ideal_private_certificate");""!==b.val()&&""!==c.val()?(e.extraSettings.find("tr.pk-cert").hide(),e.extraSettings.find(".pk-cert-error").hide()):e.extraSettings.find(".pk-cert-ok").hide()},this.togglePkCertFields=function(a){return a.preventDefault&&a.preventDefault(),e.pkCertFieldsToggle.hasClass("active")?(e.pkCertFieldsToggle.removeClass("active"),e.extraSettings.find("tr.pk-cert").hide()):(e.pkCertFieldsToggle.addClass("active"),e.extraSettings.find("tr.pk-cert").show()),c.updateRowBackgroundColor(),!1},c.initTabs(),c.updateFields(),e.variantId.change(c.updateFields),e.pkCertFieldsToggle.click(c.togglePkCertFields),a(window).resize(function(){a.isArray(c.settingElements)&&(a(window).width()>=960?(a.each(c.settingElements,function(a,b){b.hide()}),c.updateFields()):a.each(c.settingElements,function(a,b){b.show()}))})};a.fn.pronamicPayGatewayConfigEditor=function(){return this.each(function(){var c=a(this);if(!c.data("pronamic-pay-gateway-config-editor")){var d=new b(this);c.data("pronamic-pay-gateway-config-editor",d)}})};var c=function(b){var c=this,d=a(b),e={};e.paymentMethods=d.find('select[name="pronamic_pay_test_payment_method"]'),this.updateInputVisibility=function(){var a=e.paymentMethods.val();""!==a&&d.find(".pronamic-pay-test-payment-method").hide().filter("."+a).show()},c.updateInputVisibility(),e.paymentMethods.change(c.updateInputVisibility),d.on("keydown",'input[name="test_amount"]',function(a){13===a.keyCode&&d.find('input[name="test_pay_gateway"]').click()})};a.fn.pronamicPayGatewayTest=function(){return this.each(function(){var b=a(this);if(!b.data("pronamic-pay-gateway-test")){var d=new c(this);b.data("pronamic-pay-gateway-test",d)}})};var d=function(b){var c=this,d=a(b),e={};e.amountMethod=d.find('select[name="_pronamic_payment_form_amount_method"]'),this.updateAmountsVisibility=function(){var a=e.amountMethod.val();"choices_only"===a||"choices_and_input"===a?d.find('input[name="_pronamic_payment_form_amount_choices[]"]').closest("div").show():d.find('input[name="_pronamic_payment_form_amount_choices[]"]').closest("div").hide()},this.maybeAddAmountChoice=function(){e.amountChoices=d.find('input[name="_pronamic_payment_form_amount_choices[]"]');var a=e.amountChoices.filter(function(){return""===this.value});if(0===a.length){var b=e.amountChoices.last().closest("div"),c=b.clone(),f="_pronamic_payment_form_amount_choice_"+e.amountChoices.length;c.find("input").attr("id",f).val(""),c.find("label").attr("for",f),b.after(c)}},c.updateAmountsVisibility(),e.amountMethod.change(c.updateAmountsVisibility),d.on("keyup",'input[name="_pronamic_payment_form_amount_choices[]"]',function(){c.maybeAddAmountChoice()})};a.fn.pronamicPayFormOptions=function(){return this.each(function(){var b=a(this);if(!b.data("pronamic-pay-forms-options")){var c=new d(this);b.data("pronamic-pay-form-options",c)}})},a(document).ready(function(){a("#pronamic-pay-gateway-config-editor").pronamicPayGatewayConfigEditor(),a("#pronamic_payment_form_options").pronamicPayFormOptions(),a("#pronamic_gateway_test").pronamicPayGatewayTest();var b={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200,maxWidth:"400px"};a(".pronamic-pay-tip").tipTip(b)})}(jQuery);