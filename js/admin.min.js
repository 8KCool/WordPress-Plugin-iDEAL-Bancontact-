!function(a){var b=function(b){var c=this,d=a(b),e={};e.variantId=d.find("#pronamic_gateway_id"),e.extraSettings=d.find("div.extra-settings"),e.sectionHeaders=d.find(".gateway-config-section-header"),e.tabs=d.find(".pronamic-pay-tabs"),e.tabItems=d.find("ul.pronamic-pay-tabs-items"),e.pkCertFieldsToggle=a("#pk-cert-fields-toggle"),this.updateFields=function(){c.selectedVariant=e.variantId.find("option:selected"),c.settings=c.selectedVariant.data("pronamic-pay-settings"),d.find(".extra-settings").hide(),c.settingElements=[],a.isArray(c.settings)&&a.each(c.settings,function(a,b){d.find(".setting-"+b).show()});var b=c.selectedVariant.text().split(" - ")[0].replace(/ \(.*\)/,"");e.tabItems.find(":visible").first().text(b).click(),a("#pronamic-pay-gateway-description").html(c.selectedVariant.attr("data-gateway-description")),e.pkCertFieldsToggle.length>0&&e.extraSettings.find("tr.pk-cert").hide()},this.updateRowBackgroundColor=function(){var a=e.extraSettings.find(".form-table tr");a.removeClass("even"),a.filter(":visible:even").addClass("even")},this.initTabs=function(){a.each(e.sectionHeaders,function(b,c){var d=a(c),f=d.find("h4").text(),g=d.parents("div")[0].className;e.tabItems.append(a("<li>"+f+"</li>").addClass(g).removeClass("pronamic-pay-tab"))}),e.tabItems.next().after(e.tabItems),e.tabItems.find("li").click(c.showTabSettings)},this.showTabSettings=function(){var b=a(this);e.extraSettings.hide().eq(b.index()).show()},this.togglePkCertFields=function(a){return a.preventDefault&&a.preventDefault(),e.pkCertFieldsToggle.hasClass("active")?(e.pkCertFieldsToggle.removeClass("active"),e.extraSettings.find("tr.pk-cert").hide()):(e.pkCertFieldsToggle.addClass("active"),e.extraSettings.find("tr.pk-cert").show()),c.updateRowBackgroundColor(),!1},c.initTabs(),c.updateFields(),e.variantId.change(c.updateFields),e.pkCertFieldsToggle.click(c.togglePkCertFields)};a.fn.pronamicPayGatewayConfigEditor=function(){return this.each(function(){var c=a(this);if(!c.data("pronamic-pay-gateway-config-editor")){var d=new b(this);c.data("pronamic-pay-gateway-config-editor",d)}})};var c=function(b){var c=this,d=a(b),e={};e.tabItems=d.find("ul.pronamic-pay-tabs-items"),e.tabs=d.find(".pronamic-pay-tab"),e.tabItems=d.find("ul.pronamic-pay-tabs-items"),this.updateRowBackgroundColor=function(){var a=e.tabs.find(".form-table tr");a.removeClass("even"),a.filter(":visible:even").addClass("even")},this.showTab=function(){var b=a(this);e.tabItems.find("li").removeClass("active"),b.addClass("active"),e.tabs.hide().eq(b.index()).show(),c.updateRowBackgroundColor(),c.visibleTabItems=e.tabItems.find("li:visible"),c.activeTabItem=b},this.responsiveTabs=function(){if(a(window).width()>960)e.tabs.hide(),c.activeTabItem?c.activeTabItem.click():e.tabItems.find("li:visible").first().click();else{if(!c.visibleTabItems)return;e.tabs.hide(),a.each(c.visibleTabItems,function(b,c){e.tabs.eq(a(c).index()).show()})}},e.tabItems.find("li").click(c.showTab),e.tabItems.find("li:visible").first().click(),a(window).resize(c.responsiveTabs)};a.fn.pronamicPayTabs=function(){return this.each(function(){var b=a(this);if(!b.data("pronamic-pay-tabs")){var d=new c(this);b.data("pronamic-pay-tabs",d)}})};var d=function(b){var c=this,d=a(b),e={};e.paymentMethods=d.find('select[name="pronamic_pay_test_payment_method"]'),this.updateInputVisibility=function(){var a=e.paymentMethods.val();""!==a&&d.find(".pronamic-pay-test-payment-method").hide().filter("."+a).show()},c.updateInputVisibility(),e.paymentMethods.change(c.updateInputVisibility),d.on("keydown",'input[name="test_amount"]',function(a){13===a.keyCode&&d.find('input[name="test_pay_gateway"]').click()})};a.fn.pronamicPayGatewayTest=function(){return this.each(function(){var b=a(this);if(!b.data("pronamic-pay-gateway-test")){var c=new d(this);b.data("pronamic-pay-gateway-test",c)}})};var e=function(b){var c=this,d=a(b),e={};e.amountMethod=d.find('select[name="_pronamic_payment_form_amount_method"]'),this.updateAmountsVisibility=function(){var a=e.amountMethod.val();"choices_only"===a||"choices_and_input"===a?d.find('input[name="_pronamic_payment_form_amount_choices[]"]').closest("div").show():d.find('input[name="_pronamic_payment_form_amount_choices[]"]').closest("div").hide()},this.maybeAddAmountChoice=function(){if(e.amountChoices=d.find('input[name="_pronamic_payment_form_amount_choices[]"]'),0===e.amountChoices.filter(function(){return""===this.value}).length){var a=e.amountChoices.last().closest("div"),b=a.clone(),c="_pronamic_payment_form_amount_choice_"+e.amountChoices.length;b.find("input").attr("id",c).val(""),b.find("label").attr("for",c),a.after(b)}},c.updateAmountsVisibility(),e.amountMethod.change(c.updateAmountsVisibility),d.on("keyup",'input[name="_pronamic_payment_form_amount_choices[]"]',function(){c.maybeAddAmountChoice()})};a.fn.pronamicPayFormOptions=function(){return this.each(function(){var b=a(this);if(!b.data("pronamic-pay-forms-options")){var c=new e(this);b.data("pronamic-pay-form-options",c)}})},a(document).ready(function(){a("#pronamic-pay-gateway-config-editor").pronamicPayGatewayConfigEditor(),a("#pronamic_payment_form_options").pronamicPayFormOptions(),a("#pronamic_gateway_test").pronamicPayGatewayTest(),a(".pronamic-pay-tabs").pronamicPayTabs();var b={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200,maxWidth:"400px"};a(".pronamic-pay-tip").tipTip(b)})}(jQuery);